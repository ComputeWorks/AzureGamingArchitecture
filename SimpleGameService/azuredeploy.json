{
  "parameters": {
    "SqlServerName": {
      "type": "string"
    },
    "SqlAdministratorLogin": {
      "type": "string"
    },
    "SqlAdministratorLoginPassword": {
      "type": "securestring"
    },
    "databaseUsername": {
      "type": "string"
    },
    "databasePassword": {
      "type": "securestring"
    },
    "databaseName": {
      "type": "string"
    },
    "SqlEdition": {
      "type": "string",
      "defaultValue": "Standard"
    },
    "SqlCollation": {
      "type": "string",
      "defaultValue": "SQL_Latin1_General_CP1_CI_AS"
    },
    "DBmaxSizeBytes": {
      "type": "string",
      "defaultValue": "268435456000"
    },
    "SqlRequestedServiceObjectiveId": {
      "type": "string",
      "defaultValue": "f1173c43-91bd-4aaa-973c-54e79e15235b"
    },
    "WebSiteName": {
      "type": "string"
    },
    "hostingPlanName": {
      "type": "string"
    },
    "hostingEnvironment": {
      "type": "string"
    },
    "hostingPlanSku": {
      "type": "string",
      "defaultValue": "Standard"
    },
    "hostingPlanSkuCode": {
      "type": "string",
      "defaultValue": "S1"
    },
    "workerSizeID": {
      "type": "string",
      "defaultValue": "0"
    }
  },
    "resources": [
      {
        "name": "[parameters('WebSiteName')]",
        "type": "Microsoft.Web/sites",
        "properties": {
          "siteConfig": {
            "connectionStrings": [
              {
                "name": "defaultConnection",
                "ConnectionString": "[concat('Data Source=tcp:' , reference(concat('Microsoft.SQL/servers/',parameters('SqlServerName'))).fullyQualifiedDomainName , ',1433;Initial Catalog=GameServiceDB;User Id=gameservice@',reference(concat('Microsoft.SQL/servers/',parameters('SqlServerName'))).fullyQualifiedDomainName,';Password=',parameters('SqlAdministratorLoginPassword'),';')]",
                "type": "SQLAzure"
              }
            ]
          },
          "name": "[parameters('WebSiteName')]",
          "serverFarmId": [ "concat('Microsoft.Web/serverfarms/'", "parameters('hostingPlanName'))" ],
          "hostingEnvironment": "[parameters('hostingEnvironment')]"
        },
        "apiVersion": "2016-03-01",
        "location": "[resourceGroup().location]",

        "dependsOn": [
          "[concat('Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]"
        ]
      },
      {
        "apiVersion": "2016-09-01",
        "name": "[parameters('hostingPlanName')]",
        "type": "Microsoft.Web/ServerFarms",
        "location": "[resourceGroup().location]",
        "properties": {
          "name": "[parameters('hostingPlanName')]",
          "workerSizeId": "[parameters('workerSizeID')]",
          "reserved": false,
          "numberOfWorkers": "1",
          "hostingEnvironment": "[parameters('hostingEnvironment')]"
        },
        "sku": {
          "Tier": "[parameters('hostingPlanSku')]",
          "Name": "[parameters('hostingPlanSkuCode')]"
        }
      },
        {
            "apiVersion": "2014-04-01",
            "name": "[concat(parameters('WebSiteName'),'Insights')]",
            "type": "microsoft.insights/components",
            "location": "West Europe",
          "dependsOn": [
            "[concat('Microsoft.Web/sites/', parameters('WebSiteName'))]"
          ],
          "tags": {
            "[concat('hidden-link:', resourceGroup().id, '/providers/Microsoft.Web/sites/', parameters('WebSiteName'))]": "Resource"
          },
          "properties": {
            "ApplicationId": "[parameters('WebSiteName')]",
            "Request_Source": "IbizaWebAppExtensionCreate"
          }
        },
      {
        "name": "[parameters('SqlServerName')]",
        "type": "Microsoft.Sql/servers",
        "location": "[resourceGroup().location]",
        "apiVersion": "2014-04-01-preview",
        "properties": {
          "administratorLogin": "[parameters('SqlAdministratorLogin')]",
          "administratorLoginPassword": "[parameters('SqlAdministratorLoginPassword')]",
          "version": "12.0"
        },
        "resources": [
          {
            "name": "[parameters('databaseName')]",
            "type": "databases",
            "location": "[resourceGroup().location]",
            "apiVersion": "2014-04-01-preview",
            "dependsOn": [
              "[concat('Microsoft.Sql/servers/', parameters('SqlServerName'))]"
            ],
            "properties": {
              "edition": "[parameters('Sqledition')]",
              "collation": "[parameters('Sqlcollation')]",
              "maxSizeBytes": "[parameters('DBmaxSizeBytes')]",
              "requestedServiceObjectiveId": "[parameters('SqlRequestedServiceObjectiveId')]"
            }
          },
          {
            "apiVersion": "2014-04-01-preview",
            "dependsOn": [
              "[concat('Microsoft.Sql/servers/', parameters('SqlServerName'))]"
            ],
            "location": "[resourceGroup().location]",
            "name": "AllowAllWindowsAzureIps",
            "properties": {
              "endIpAddress": "0.0.0.0",
              "startIpAddress": "0.0.0.0"
            },
            "type": "firewallrules"
          }
        ]
      }
    ],
    "$schema": "http://schema.management.azure.com/schemas/2014-04-01-preview/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0"
}